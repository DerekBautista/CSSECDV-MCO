<!--
    account-settings.hbs
    Purpose:
        - This is the page where the user can change their account settings.
-->

            <!-- Container -->
            <div class="account-container">
                <div class="account-photo-holder">
                    <h1 class="profile-pic-title fw-bold">Profile Photo</h1>
                    <div class="account-photo">
                        <img id="image-preview" src="/static/img/default-profile-pic.jpg" alt="profile-picture">
                    </div>
                    

                    <div class="account-photo-upload">
                        <form id="uploadForm" enctype="multipart/form-data">
                            <div>
                                <label for="image-upload">Import Image</label>
                                <input type="file" id="image-upload" name="image_upload" accept="image/*">
                            </div>
                            <div>
                                <button class="btn btn-primary" type="submit">Save Image</button>
                            </div>
                            
                        </form>
                    </div>

                </div>
                <div class="details-containers">
                <div class="account-details-holder">
                    <h1 class="profile-pic-title fw-bold">Account Details</h1>

                    <form action="#" method="post" id="edit-account-form">
								
                        <input type="hidden" name="action" value="save-edited-account">
                        
                        <div class="row">
                            <div class="col">
                                <div class="mb-3">
                                    <label for="acc-firstName" class="form-label">First Name</label>
                                    <input type="text" value="{{ name }}" name="acc_firstName" class="form-control" id="acc-firstName" placeholder="Enter First Name" required>
                                    
                                    <!-- Error Message -->
                                    <div class="alert alert-danger mt-3" role="alert" style="display: none;"> </div>
                                
                                
                                </div>
                            </div>
                            <div class="col">
                                <div class="mb-3">
                                    <label for="acc-middleName" class="form-label">Middle Name</label>
                                    <input type="text" value="{{ middlename }}" name="acc_middleName" class="form-control" id="acc-middleName" placeholder="Enter Middle Name">
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col">
                                <div class="mb-3">
                                    <label for="acc-lastName" class="form-label">Last Name</label>
                                    <input type="text" value="{{ lastname }}" name="acc_lastName" class="form-control" id="acc-lastName" placeholder="Enter Last Name" required>

                                    <!-- Error Message -->
                                    <div class="alert alert-danger mt-3" role="alert" style="display: none;"> </div>

                                </div>
                            </div>
                            <div class="col">
                                <div class="mb-3">
                                    <label for="acc-suffix" class="form-label">Suffix</label>
                                    <input type="text" value="{{ suffix }}" name="acc_suffix" class="form-control" id="acc-suffix" placeholder="Enter Suffix">
                                </div>
                            </div>
                        </div>

                        <div class="mb-3 mt-3">
                            <label for="acc-companyID" class="index-form-label">Company ID</label>
                            <input type="number" min="0" value="{{ companyID }}" name="acc_companyID" onkeypress="return (event.charCode !=8 && event.charCode ==0 || (event.charCode >= 48 && event.charCode <= 57))" id="acc-companyID" class="form-control" placeholder="Enter Company ID" required>
                        </div>
                          <!-- Error Message -->
                            <div class="alert alert-danger mt-3" role="alert" style="display: none;"> </div>

                        <div class="text-center">
                        <button type="submit" class="btn btn-success mt-3">Save Changes</button>
                        </div>
                    </form>
                </div>
                          
                
                        <!-- Password Reset Questions Section -->
            <br>
            <div class="account-details-holder password-holder">
            <h1 class="profile-pic-title fw-bold">Password Reset</h1>
            <form action="/account-settings/passwordchange" method="post" id="edit-account-form">
            <div class="mb-3 mt-3">
                <h5 class="form-label">Password Reset Questions</h5>
                <p class="form-label">Please select questions that have unique answers only you would know.</p>
                
                <div class="mb-3">
                    <label for="security-question-1" class="form-label">Security Question 1</label>
                    <p class="form-label">{{ securityQuestion1 }}</p>
                    <input type="text" class="form-control mt-2" name="security_answer_1" id="security_answer_1" placeholder="Your answer" required>
                </div>

                <div class="mb-3">
                    <label for="security-question-2" class="form-label">Security Question 2</label>
                    <p class="form-label">{{ securityQuestion2 }}</p>
                    <input type="text" class="form-control mt-2" name="security_answer_2"  id="security_answer_2" placeholder="Your answer" required>
                </div>
            </div>

            <!-- Password Change Section -->
            <div class="mb-3 mt-3">
                <label for="acc-password" class="index-form-label">New Password</label>
                <div class="input-group">
                    <input type="password" name="password" id="acc-password" class="form-control" placeholder="Enter New Password" required>
                    <span class="input-group-text" id="acc-show-hide-password">
                        <i class="fas fa-eye-slash" aria-hidden="true"></i>
                    </span>
                </div>
                <small class="text-muted">Password must be different from your last 5 passwords</small>
                
                <!-- Error Message -->
                <div class="alert alert-danger mt-3" role="alert" style="display: none;"></div>
            </div>

            <div class="mb-3 mt-3">
                <label for="acc-confirmPassword" class="index-form-label">Confirm New Password</label>
                <div class="input-group">
                    <input type="password" name="acc_confirm" id="acc-confirm-password" class="form-control" placeholder="Confirm New Password" required>
                    <span class="input-group-text" id="acc-confirm-show-hide-password">
                        <i class="fas fa-eye-slash" aria-hidden="true"></i>
                    </span>
                </div>
                
                <!-- Error Message -->
                <div class="alert alert-danger mt-3" role="alert" style="display: none;"></div>
            </div>

            <div class="mb-3 mt-3">
                <label for="current-password" class="index-form-label">Current Password</label>
                <div class="input-group">
                    <input type="password" name="current_password" id="current-password" class="form-control" placeholder="Enter Current Password" required>
                    <span class="input-group-text" id="current-show-hide-password">
                        <i class="fas fa-eye-slash" aria-hidden="true"></i>
                    </span>
                </div>
                
                <!-- Error Message -->
                <div class="alert alert-danger mt-3" id="password-change-message" role="alert" style="display: none;"></div>
            </div>

            <div class="text-center">
                <button type="submit" class="btn btn-success mt-3" id="passwordChangeSubmit">Save Changes</button>
            </div>
        </form>
    </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Password show/hide functionality
    document.getElementById('acc-show-hide-password').addEventListener('click', function() {
        togglePasswordVisibility('acc-password', this);
    });
    
    document.getElementById('acc-confirm-show-hide-password').addEventListener('click', function() {
        togglePasswordVisibility('acc-confirm-password', this);
    });
    
    document.getElementById('current-show-hide-password').addEventListener('click', function() {
        togglePasswordVisibility('current-password', this);
    });

    function togglePasswordVisibility(inputId, element) {
        const input = document.getElementById(inputId);
        const icon = element.querySelector('i');
        
        if (input.type === 'password') {
            input.type = 'text';
            icon.classList.remove('fa-eye-slash');
            icon.classList.add('fa-eye');
        } else {
            input.type = 'password';
            icon.classList.remove('fa-eye');
            icon.classList.add('fa-eye-slash');
        }
    }

    // Form validation
    document.getElementById('edit-account-form').addEventListener('submit', function(e) {
        e.preventDefault();
        
        // Clear previous errors
        document.querySelectorAll('.alert-danger').forEach(el => {
            el.style.display = 'none';
            el.textContent = '';
        });
        
        // Validate password match
        const newPassword = document.getElementById('acc-password').value;
        const confirmPassword = document.getElementById('acc-confirm-password').value;
        
        if (newPassword !== confirmPassword) {
            showError('Passwords do not match', document.querySelector('#acc-confirm-password').closest('.mb-3').querySelector('.alert-danger'));
            return;
        }
        
        // Additional validation would be handled server-side
        this.submit();
    });
    
    function showError(message, element) {
        element.textContent = message;
        element.style.display = 'block';
    }
});
</script>
            <!-- End of Container -->
